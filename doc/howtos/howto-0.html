<!DOCTYPE HTML>
<html>
<head>
<title>Boomerang Howto #0: How to read data out of a beacon or before_beacon event handler</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="howtos.css">
</head>
<body>
<span style="float:right;"><a href="index.html">Index</a></span>
<h1>Boomerang Howto #0:<br>How to read data out of a beacon or before_beacon event handler</h1>
<p>
For all subsequent examples, you'll need to pull performance data out of the beacon or out of a
<code>before_beacon</code> event handler.  This howto explains how to do that.
</p>

<h2>Beacon results back to your server</h2>
<p>
For most cases you'd want to send performance data back to your server so you can analyse it later
and take action against it.  The first thing you need to do is set up a url that the javascript
will use as a beacon.  We'll look at the back end details a little later.  You tell boomerang
about your beacon URL by passing the <code>beacon_url</code> parameter to the <code>BOOMR.init()</code>
method:
</p>
<pre>
&lt;script src="boomerang.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
BOOMR.init({
		beacon_url: "http://yoursite.com/path/to/beacon.gif"
	});
&lt;/script&gt;
</pre>

<p>
I've used beacon.gif as an example, but it could really be any thing.  You could write a script
in PHP or C# or JSP to handle the beacons as well.  I just use a URL that does nothing on the
back end, and then later look at my apache web logs to get the beaconed parameters in a batch.
</p>

<h3>Beacon parameters</h3>
<p>
The beacon that hits your server will have several parameters.  Each plugin also adds its own
parameters, so if you have custom plugins set up, you'll get parameters from them as well.
This is what you get from the default install:
</p>

<h4>boomerang parameters</h4>
<dl>
<dt>v</dt> <dd>Version number of the boomerang library in use.</dd>
</dl>

<h4>roundtrip plugin parameters</h4>
<dl>
<dt>t_done</dt> <dd>[optional] Round trip time of the page.</dd>
<dt>t_page</dt> <dd>[optional] Time taken from the head of the page to page_ready.  Requires dev effort.</dd>
<dt>t_other</dt> <dd>[optional] Comma separated list of additional timers set by page developer.  Each timer is of the format <code>name|value</code></dd>
<dt>u</dt> <dd>URL of page that sends the beacon.</dd>
<dt>r</dt> <dd>URL of page that set the start time of the beacon.</dd>
<dt>r2</dt> <dd>[optional] URL of referrer of current page.  Only set if different from <code>r</code> and <code>strict_referrer</code> has been explicitly turned off.</dd>
</dl>

<h4>bandwidth &amp; latency plugin</h4>
<dl>
<dt>bw</dt> <dd>User's measured bandwidth in bytes per second</dd>
<dt>bw_err</dt> <dd>95% confidence interval margin of error in measuring user's bandwidth</dd>
<dt>lat</dt> <dd>User's measured HTTP latency in milliseconds</dd>
<dt>lat_err</dt> <dd>95% confidence interval margin of error in measuring user's latency</dd>
</dl>

<h2>Read results from javascript</h2>
<p>
There may be cases where rather than beacon results back to your server (or alongside beaconing), you may want
to inspect performance numbers in javascript itself and perhaps make some decisions based on this data.
You can get at this data before the beacon fires by subscribing to the <code>before_beacon</code> event.
</p>

<pre>
BOOMR.subscribe('before_beacon', function(o) {
	// Do something with o
});
</pre>

<p>
Your event handler is called with a single object parameter.  This object contains all of the beacon parameters
described above except for the <code>v</code> (version) parameter.  To get boomerang's version number, use
<code>BOOMR.version</code>.
</p>

<p>
In all these howto documents, we use the following code in the <code>before_beacon</code> handler:
</p>
<pre>
BOOMR.subscribe('before_beacon', function(o) {
	var html = "";
	if(o.t_done) { html += "This page took " + o.t_done + "ms to load&lt;br&gt;"; }
	if(o.bw) { html += "Your bandwidth to this server is " + parseInt(o.bw/1024) + "kbps (±" + parseInt(o.bw_err*100/o.bw) + "%)&lt;br&gt;"; }
	if(o.lat) { html += "Your latency to this server is " + parseInt(o.lat) + "±" + o.lat_err + "ms&lt;br&gt;"; }

	document.getElementById('results').innerHTML = html;
});
</pre>

<p id="results">
</p>

<script src="../../boomerang.js" type="text/javascript"></script>
<script src="howtos.js" type="text/javascript"></script>
<script type="text/javascript">
BOOMR.init({
		user_ip: '10.0.0.1',
		BW: {
			base_url: '../../images/',
			cookie: 'HOWTO-BA'
		},
		RT: {
			cookie: 'HOWTO-RT'
		}
	});
</script>
</body>
</html>
